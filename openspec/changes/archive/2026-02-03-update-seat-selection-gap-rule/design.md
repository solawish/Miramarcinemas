# Design: 選位間隔規則與座位表解析

## Context
- 座位表為 `id=seatTable` 的表格，同一排（同一 RowIndex／同一列）的 `td` 以 `style=background-color` 區分可選（white）與不可選（transparent、gray）。
- 現有選位邏輯僅過濾可選座位並依 PhysicalName 與 SeatId 中間值挑選，未考慮與不可選座位或已選座位的「間隔」。

## Goals / Non-Goals
- **Goals**：在保留「先區域、後中間」的前提下，加入同一排內「與不可選／已選座位不得僅空 1 格」的約束；解析階段能區分可選／不可選並提供同一排的相對位置。
- **Non-Goals**：不改變 API 或表單格式；不新增使用者手動選位 UI。

## Decisions
- **可選／不可選定義**：僅 `background-color` 為 white（或 `rgb(255,255,255)`）視為可選；`transparent`、`gray`（或 `rgb(128,128,128)` 等）視為不可選，不納入可選座位清單，但需在解析時記錄其位置以供間隔檢查。
- **「同一排」**：以同一 PhysicalName 與同一 RowIndex 定義同一排；同一排內以 ColumnIndex 或 SeatId 的數值順序表示左右位置，用於計算「中間空幾格」。
- **間隔計算**：同一排內兩座位 A、B 的「中間空格數」= |col(A) − col(B)| − 1。約束為：該值不得為 1（即不得僅空 1 格）；可為 0（相鄰）或 ≥ 2。
- **選位演算法**：依既有優先順序產生候選順序（PhysicalName 降序、同區取中間），依序嘗試將候選納入已選名單；每納入一席前，檢查該席與同一排內所有不可選座位、以及與已選座位之間是否違反「僅空 1 格」。若違反則跳過該候選，改試下一個，直到湊滿票數或候選用盡。

## Alternatives Considered
- **只過濾可選、不檢查間隔**：維持現狀，會留下單一空位夾在選位與不可選／已選之間，體驗較差。
- **解析時只回傳可選座位、不帶不可選位置**：無法實作「與不可選中間空 1 格」檢查，故需在解析階段一併取得同一排內不可選座位的欄位索引（或等效位置）。

## Risks / Trade-offs
- 若可選座位很少且多數都與不可選／已選「空 1 格」，可能無法湊滿票數；此時行為可訂為：盡量選滿，若無法滿足間隔則仍可選較少席次並在日誌中提示（具體以 spec 為準）。

## Open Questions
- 無。
